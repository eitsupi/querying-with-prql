"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[90],{7528:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>x,contentTitle:()=>h,default:()=>o,frontMatter:()=>d,metadata:()=>a,quartoRawHtml:()=>g,toc:()=>c});var n=l(5893),s=l(1151),i=l(4866),r=l(5162);const d={title:"Reshaping and Tidy Data",description:"Make the data tidy.",engine:"knitr",knitr:{opts_chunk:{connection:"con","engine-opts":{target:"sql.duckdb",use_glue:!0,info_string:'{.sql filename="SQL"}'}}},execute:{cache:!0},sidebar_position:4},h=void 0,a={id:"tidy",title:"Reshaping and Tidy Data",description:"Make the data tidy.",source:"@site/docs/tidy.mdx",sourceDirName:".",slug:"/tidy",permalink:"/querying-with-prql/tidy",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Reshaping and Tidy Data",description:"Make the data tidy.",engine:"knitr",knitr:{opts_chunk:{connection:"con","engine-opts":{target:"sql.duckdb",use_glue:!0,info_string:'{.sql filename="SQL"}'}}},execute:{cache:!0},sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Define Functions",permalink:"/querying-with-prql/method_chaining"},next:{title:"Timeseries",permalink:"/querying-with-prql/timeseries"}},x={},c=[{value:"Read the Data",id:"read-the-data",level:2},{value:"Download",id:"download",level:3},{value:"Load the Data",id:"load-the-data",level:3},{value:"Cleaning",id:"sec-cleaning",level:2},{value:"Tidy Data",id:"sec-tidy-data",level:2},{value:"Unpivot",id:"unpivot",level:3},{value:"Pivot",id:"pivot",level:3}],g=["<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 5)</small>","</div>","<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 6)</small>","</div>","<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 5)</small>","</div>","<div><style>\n.dataframe > thead > tr,\n.dataframe > tbody > tr {\n  text-align: right;\n  white-space: pre-wrap;\n}\n</style>\n<small>shape: (5, 10)</small>","</div>"];function j(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components},{Details:l}=t;return l||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsxs)(t.p,{children:["This page is based on the chapter ",(0,n.jsx)(t.a,{href:"https://kevinheavey.github.io/modern-polars/tidy.html",children:"\u201cReshaping and Tidy Data\u201d"})," of the Modern Polars book."]})}),"\n",(0,n.jsx)(t.h2,{id:"read-the-data",children:"Read the Data"}),"\n",(0,n.jsx)(t.admonition,{type:"important",children:(0,n.jsxs)(t.p,{children:["Since the PRQL and SQL results shown on this page are after being converted to R DataFrame via knitr, they have been converted from DuckDB types to R types. So ",(0,n.jsx)(t.code,{children:"NULL"})," in DuckDB is shown as ",(0,n.jsx)(t.code,{children:"NA"}),"."]})}),"\n",(0,n.jsx)(t.h3,{id:"download",children:"Download"}),"\n",(0,n.jsx)(t.p,{children:"Download the data to be analysis (tables on the website) and write the data to CSV files."}),"\n",(0,n.jsxs)(t.p,{children:["This document uses R to download the data from the source here, but we can also download and use the CSV files included in the ",(0,n.jsx)(t.a,{href:"https://github.com/kevinheavey/modern-polars/tree/master/data/nba",children:"kevinheavey/modern-polars"})," GitHub repository."]}),"\n",(0,n.jsxs)(i.Z,{children:[(0,n.jsx)(r.Z,{value:"R",children:(0,n.jsxs)(l,{class:"code-fold",children:[(0,n.jsx)("summary",{children:"Code"}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:'nba_dir <- file.path("data", "nba")\n\nmonths <- c(\n  "october",\n  "november",\n  "december",\n  "january",\n  "february",\n  "march",\n  "april",\n  "may",\n  "june"\n)\n\ncolumn_names <- c(\n  date = "date",\n  away_team = "visitor_neutral",\n  away_points = "pts",\n  home_team = "home_neutral",\n  home_points = "pts_2"\n)\n\n.write_data <- function(month) {\n  base_url <- "http://www.basketball-reference.com/leagues/NBA_2016_games-{month}.html"\n\n  glue::glue(base_url, month = month) |>\n    rvest::read_html() |>\n    rvest::html_table() |>\n    (\\(x) x[[1]])() |> # TODO: Rewrite after R 4.3\n    janitor::clean_names() |>\n    dplyr::select(all_of(column_names)) |>\n    dplyr::filter(date != "Playoffs") |>\n    readr::write_csv(file.path(nba_dir, glue::glue("{month}.csv")))\n}\n\nif (!fs::dir_exists(nba_dir)) {\n  fs::dir_create(nba_dir)\n  months |>\n    purrr::walk(.write_data)\n}\n'})})]})}),(0,n.jsxs)(r.Z,{value:"Shell",children:[(0,n.jsxs)(t.p,{children:["This is a sample command to download the CSV files from the ",(0,n.jsx)(t.code,{children:"kevinheavey/modern-polars"})," GitHub repository."]}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Terminal"',children:"mkdir data/nba\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/october.csv -o data/nba/october.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/november.csv -o data/nba/november.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/december.csv -o data/nba/december.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/january.csv -o data/nba/january.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/february.csv -o data/nba/february.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/march.csv -o data/nba/march.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/april.csv -o data/nba/april.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/may.csv -o data/nba/may.csv\ncurl -sL https://github.com/kevinheavey/modern-polars/raw/87539190dde3e99d5e4c4f9957c78932a33075a0/data/nba/june.csv -o data/nba/june.csv\n"})})]})]}),"\n",(0,n.jsx)(t.h3,{id:"load-the-data",children:"Load the Data"}),"\n",(0,n.jsx)(t.p,{children:"After the CSV files are ready, load these into DuckDB (in-memory) database table, R DataFrame, and Python polars.LazyFrame."}),"\n",(0,n.jsxs)(i.Z,{children:[(0,n.jsxs)(r.Z,{value:"DuckDB",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"CREATE TABLE tab AS FROM read_csv_auto('data/nba/*.csv')\n"})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"FROM tab\nLIMIT 5\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Jan 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Orlando Magic"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"91"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Washington Wizards"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"103"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Jan 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Dallas Mavericks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"82"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Miami Heat"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"106"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Jan 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Charlotte Hornets"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"94"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Toronto Raptors"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"104"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Jan 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New York Knicks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"81"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"108"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Jan 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Philadelphia 76ers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"84"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Los Angeles Lakers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"93"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"R DataFrame",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:'library(dplyr, warn.conflicts = FALSE)\n\ndf <- readr::read_csv(\n  fs::dir_ls("data/nba", glob = "*.csv")\n)\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:"df |> head(5)\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Apr 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Philadelphia 76ers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"91"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Charlotte Hornets"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"100"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Apr 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Dallas Mavericks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"98"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"89"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Apr 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Brooklyn Nets"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"91"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New York Knicks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"105"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Apr 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"110"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Atlanta Hawks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"108"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Fri, Apr 1, 2016"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Toronto Raptors"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"99"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"Python polars.LazyFrame",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:'import polars as pl\n\nlf = pl.scan_csv("data/nba/*.csv")\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:"lf.head(5).collect()\n"})}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[0]}}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"date"}),(0,n.jsx)(t.th,{children:"away_team"}),(0,n.jsx)(t.th,{children:"away_points"}),(0,n.jsx)(t.th,{children:"home_team"}),(0,n.jsx)(t.th,{children:"home_points"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"i64"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"i64"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:'"Fri, Apr 1, 20\u2026'}),(0,n.jsx)(t.td,{children:'"Philadelphia 7\u2026'}),(0,n.jsx)(t.td,{children:"91"}),(0,n.jsx)(t.td,{children:'"Charlotte Horn\u2026'}),(0,n.jsx)(t.td,{children:"100"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:'"Fri, Apr 1, 20\u2026'}),(0,n.jsx)(t.td,{children:'"Dallas Maveric\u2026'}),(0,n.jsx)(t.td,{children:"98"}),(0,n.jsx)(t.td,{children:'"Detroit Piston\u2026'}),(0,n.jsx)(t.td,{children:"89"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:'"Fri, Apr 1, 20\u2026'}),(0,n.jsx)(t.td,{children:'"Brooklyn Nets"'}),(0,n.jsx)(t.td,{children:"91"}),(0,n.jsx)(t.td,{children:'"New York Knick\u2026'}),(0,n.jsx)(t.td,{children:"105"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:'"Fri, Apr 1, 20\u2026'}),(0,n.jsx)(t.td,{children:'"Cleveland Cava\u2026'}),(0,n.jsx)(t.td,{children:"110"}),(0,n.jsx)(t.td,{children:'"Atlanta Hawks"'}),(0,n.jsx)(t.td,{children:"108"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:'"Fri, Apr 1, 20\u2026'}),(0,n.jsx)(t.td,{children:'"Toronto Raptor\u2026'}),(0,n.jsx)(t.td,{children:"99"}),(0,n.jsx)(t.td,{children:'"Memphis Grizzl\u2026'}),(0,n.jsx)(t.td,{children:"95"})]})]})]}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[1]}})]})]}),"\n",(0,n.jsx)(t.h2,{id:"sec-cleaning",children:"Cleaning"}),"\n",(0,n.jsxs)(t.p,{children:["Convert the ",(0,n.jsx)(t.code,{children:"date"})," column to date type and delete rows containing missing values (",(0,n.jsx)(t.code,{children:"null"}),")."]}),"\n",(0,n.jsxs)(t.p,{children:["PRQL does not have a \u201cremove rows with missing values in any column\u201d syntax (",(0,n.jsx)(t.a,{href:"https://github.com/PRQL/prql/issues/2386",children:"PRQL/prql#2386"}),"), but DuckDB SQL does (>= 0.8, ",(0,n.jsx)(t.a,{href:"https://github.com/duckdb/duckdb/pull/6621",children:"duckdb/duckdb#6621"}),"), so it can be used."]}),"\n",(0,n.jsxs)(i.Z,{children:[(0,n.jsxs)(r.Z,{value:"PRQL DuckDB",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-elm",metastring:"showLineNumbers",children:'let games = (\n  from tab\n  filter s"COLUMNS(*) IS NOT NULL"\n  derive date_new = (s"strptime(date, \'%a, %b %d, %Y\')" | as date)\n  select !{this.date} # `this` points to refer to current relation\n  sort date_new\n  derive game_id = (row_number this)\n)\n\nfrom games\ntake 5\n'})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date_new"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"97"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"1"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"106"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Atlanta Hawks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"94"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"2"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Golden State Warriors"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"111"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"3"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Washington Wizards"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"88"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Orlando Magic"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"87"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"4"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Philadelphia 76ers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Boston Celtics"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"5"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"SQL DuckDB",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"CREATE TABLE games AS (\n  WITH _tab1 AS (\n      SELECT\n        * REPLACE (strptime(date, '%a, %b %d, %Y')::date AS date)\n      FROM tab\n      WHERE COLUMNS(*) IS NOT NULL\n    )\n\n  SELECT\n    row_number() OVER(ORDER BY date) AS game_id,\n    *\n  FROM _tab1\n  ORDER BY date\n)\n"})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"FROM games\nLIMIT 5\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"1"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"97"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"2"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"106"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Atlanta Hawks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"94"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"3"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Golden State Warriors"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"111"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"4"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Washington Wizards"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"88"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Orlando Magic"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"87"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"5"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Philadelphia 76ers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Boston Celtics"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"dplyr R",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:'games <- df |>\n  filter(!if_any(everything(), is.na)) |> # Also can use `tidyr::drop_na`\n  mutate(\n    date = lubridate::parse_date_time(date, "%a, %b %d, %Y") |>\n      lubridate::as_date()\n  ) |>\n  arrange(date) |>\n  mutate(game_id = row_number(), .before = 1)\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:"games |>\n  head(5)\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"1"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"97"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"2"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"106"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Atlanta Hawks"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"94"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"3"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-27"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Golden State Warriors"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"111"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"4"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Washington Wizards"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"88"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Orlando Magic"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"87"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"5"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Philadelphia 76ers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"95"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Boston Celtics"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"Python Polars",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:'games = (\n    lf.filter(~pl.any_horizontal(pl.all().is_null())) # Also can use `polars.LazyFrame.drop_nulls`\n    .with_columns(\n        pl.col("date").str.strptime(pl.Date, "%a, %b %d, %Y"),\n    )\n    .sort("date")\n    .with_row_index("game_id")\n    .collect()\n)\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:"games.head(5)\n"})}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[2]}}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"game_id"}),(0,n.jsx)(t.th,{children:"date"}),(0,n.jsx)(t.th,{children:"away_team"}),(0,n.jsx)(t.th,{children:"away_points"}),(0,n.jsx)(t.th,{children:"home_team"}),(0,n.jsx)(t.th,{children:"home_points"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"u32"}),(0,n.jsx)(t.td,{children:"date"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"i64"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"i64"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"2015-10-27"}),(0,n.jsx)(t.td,{children:'"Cleveland Cava\u2026'}),(0,n.jsx)(t.td,{children:"95"}),(0,n.jsx)(t.td,{children:'"Chicago Bulls"'}),(0,n.jsx)(t.td,{children:"97"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"2015-10-27"}),(0,n.jsx)(t.td,{children:'"Detroit Piston\u2026'}),(0,n.jsx)(t.td,{children:"106"}),(0,n.jsx)(t.td,{children:'"Atlanta Hawks"'}),(0,n.jsx)(t.td,{children:"94"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"2"}),(0,n.jsx)(t.td,{children:"2015-10-27"}),(0,n.jsx)(t.td,{children:'"New Orleans Pe\u2026'}),(0,n.jsx)(t.td,{children:"95"}),(0,n.jsx)(t.td,{children:'"Golden State W\u2026'}),(0,n.jsx)(t.td,{children:"111"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"3"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:'"Washington Wiz\u2026'}),(0,n.jsx)(t.td,{children:"88"}),(0,n.jsx)(t.td,{children:'"Orlando Magic"'}),(0,n.jsx)(t.td,{children:"87"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:'"Philadelphia 7\u2026'}),(0,n.jsx)(t.td,{children:"95"}),(0,n.jsx)(t.td,{children:'"Boston Celtics\u2026'}),(0,n.jsx)(t.td,{children:"112"})]})]})]}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[3]}})]})]}),"\n",(0,n.jsxs)(t.p,{children:["Looking at the result tables, we notice that the PRQL result is different from the other results; A column named ",(0,n.jsx)(t.code,{children:"date"})," in other results is named ",(0,n.jsx)(t.code,{children:"date_new"})," in PRQL. This is because another name is needed to avoid the behavior that using the column name ",(0,n.jsx)(t.code,{children:"date"})," here would add a new column called ",(0,n.jsx)(t.code,{children:"date:1"})," instead of updating the original ",(0,n.jsx)(t.code,{children:"date"})," column."]}),"\n",(0,n.jsxs)(t.p,{children:["In DuckDB SQL, we can use ",(0,n.jsx)(t.a,{href:"https://duckdb.org/docs/sql/expressions/star#replace-clause",children:"Replace Clause"})," to update the original column with the same column name."]}),"\n",(0,n.jsx)(t.p,{children:"The SQL generated by the PRQL compiler looks like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:'showLineNumbers title="SQL"',children:"WITH games AS (\n  SELECT\n    * EXCLUDE (date),\n    CAST(strptime(date, '%a, %b %d, %Y') AS date) AS date_new,\n    ROW_NUMBER() OVER (\n      ORDER BY\n        CAST(strptime(date, '%a, %b %d, %Y') AS date)\n    ) AS game_id\n  FROM\n    tab\n  WHERE\n    COLUMNS(*) IS NOT NULL\n)\nSELECT\n  *\nFROM\n  games\nORDER BY\n  date_new\nLIMIT\n  5\n\n-- Generated by PRQL compiler version:0.11.1 target:sql.duckdb (https://prql-lang.org)\n"})}),"\n",(0,n.jsx)(t.h2,{id:"sec-tidy-data",children:"Tidy Data"}),"\n",(0,n.jsx)(t.admonition,{type:"important",children:(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["PRQL does not yet support PIVOT and UNPIVOT. (",(0,n.jsx)(t.a,{href:"https://github.com/PRQL/prql/issues/644",children:"PRQL/prql#644"}),")"]}),"\n",(0,n.jsxs)(t.li,{children:["DuckDB SQL supports PIVOT and UNPIVOT >= 0.8. (",(0,n.jsx)(t.a,{href:"https://github.com/duckdb/duckdb/pull/6387",children:"duckdb/duckdb#6387"}),")"]}),"\n"]})}),"\n",(0,n.jsx)(t.h3,{id:"unpivot",children:"Unpivot"}),"\n",(0,n.jsx)(t.p,{children:"Transforms the data from wide format to long format. This transformation is called by names such as unpivot, pivot longer, and melt."}),"\n",(0,n.jsxs)(i.Z,{children:[(0,n.jsxs)(r.Z,{value:"PRQL DuckDB",children:[(0,n.jsx)(t.admonition,{type:"important",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"games"})," in this query is defiened in ",(0,n.jsx)("a",{href:"#sec-cleaning",class:"quarto-xref",children:"Section\xa02"})," with SQL, not with PRQL."]})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-elm",metastring:"showLineNumbers",children:'from s"""\nSELECT *\nFROM (\n  PIVOT_LONGER games\n  ON away_team, home_team\n  INTO\n    NAME variable\n    VALUE team\n)\n"""\ngroup {team} (\n  sort this.date\n  derive rest = this.date - (this.date | lag 1) - 1\n)\nselect !{away_points, home_points}\nfilter rest != null\nsort game_id\ntake 5\n'})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"variable"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"rest"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"6"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"12"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"15"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"18"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-29"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"SQL DuckDB",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"CREATE TABLE tidy AS (\n  WITH _tab1 AS (\n    PIVOT_LONGER games\n    ON away_team, home_team\n    INTO\n      NAME variable\n      VALUE team\n  ),\n\n  _tab2 AS (\n    SELECT\n      COLUMNS(x -> NOT suffix(x, '_points'))\n    FROM _tab1\n  ),\n\n  _tab3 AS (\n    SELECT\n      *,\n      date - lag(date) OVER (PARTITION BY team ORDER BY date) -1 AS rest\n    FROM _tab2\n  )\n\n  SELECT *\n  FROM _tab3\n  WHERE rest IS NOT NULL\n  ORDER BY game_id\n)\n"})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"FROM tidy\nLIMIT 5\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"variable"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"rest"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"6"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"12"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"15"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"18"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-29"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"dplyr R",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:'tidy <- games |>\n  tidyr::pivot_longer(\n    cols = c(away_team, home_team),\n    names_to = "variable",\n    values_to = "team"\n  ) |>\n  select(!ends_with("_points")) |>\n  arrange(game_id) |>\n  mutate(\n    rest = date - lag(date) - 1,\n    .by = team\n  ) |>\n  filter(!is.na(rest))\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:"tidy |>\n  head(5)\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"variable"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"team"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"rest"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"6"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"12"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"15"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"18"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-29"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"Python Polars",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:'tidy = (\n    games.melt(\n        id_vars=["game_id", "date"],\n        value_vars=["away_team", "home_team"],\n        value_name="team",\n    )\n    .sort("game_id")\n    .with_columns(\n      rest=(pl.col("date").diff().over("team").dt.total_days() - 1).cast(pl.Int8)\n    )\n    .drop_nulls("rest")\n)\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:"tidy.head(5)\n"})}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[4]}}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"game_id"}),(0,n.jsx)(t.th,{children:"date"}),(0,n.jsx)(t.th,{children:"variable"}),(0,n.jsx)(t.th,{children:"team"}),(0,n.jsx)(t.th,{children:"rest"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"u32"}),(0,n.jsx)(t.td,{children:"date"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"i8"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"5"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:'"away_team"'}),(0,n.jsx)(t.td,{children:'"Chicago Bulls"'}),(0,n.jsx)(t.td,{children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"6"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:'"home_team"'}),(0,n.jsx)(t.td,{children:'"Detroit Piston\u2026'}),(0,n.jsx)(t.td,{children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"11"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:'"away_team"'}),(0,n.jsx)(t.td,{children:'"Cleveland Cava\u2026'}),(0,n.jsx)(t.td,{children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"14"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:'"away_team"'}),(0,n.jsx)(t.td,{children:'"New Orleans Pe\u2026'}),(0,n.jsx)(t.td,{children:"0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"17"}),(0,n.jsx)(t.td,{children:"2015-10-29"}),(0,n.jsx)(t.td,{children:'"away_team"'}),(0,n.jsx)(t.td,{children:'"Memphis Grizzl\u2026'}),(0,n.jsx)(t.td,{children:"0"})]})]})]}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[5]}})]})]}),"\n",(0,n.jsx)(t.p,{children:"PRQL, SQL and dplyr remove unnecessary columns after UNPIVOT (columns that were automatically removed in the original Polars and Pandas example)."}),"\n",(0,n.jsx)(t.h3,{id:"pivot",children:"Pivot"}),"\n",(0,n.jsx)(t.p,{children:"Transforms the data from long format to wide format. This transformation is called by names such as pivot, pivot wider."}),"\n",(0,n.jsxs)(i.Z,{children:[(0,n.jsxs)(r.Z,{value:"PRQL DuckDB",children:[(0,n.jsx)(t.admonition,{type:"important",children:(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"tidy"})," in this query is defiened in ",(0,n.jsx)("a",{href:"#sec-tidy-data",class:"quarto-xref",children:"Section\xa03"})," with SQL, and ",(0,n.jsx)(t.code,{children:"games"})," is defiened in ",(0,n.jsx)("a",{href:"#sec-cleaning",class:"quarto-xref",children:"Section\xa02"})," with SQL."]})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-elm",metastring:"showLineNumbers",children:'from s"""\nSELECT *\nFROM (\n  PIVOT_WIDER tidy ON variable USING FIRST(rest) GROUP BY (game_id, date)\n)\n"""\nderive {\n  away_rest = away_team,\n  home_rest = home_team\n}\nselect !{\n  away_team,\n  home_team\n}\njoin side:left games (==game_id && ==date)\nderive {\n  home_win = games.home_points > games.away_points,\n  rest_spread = home_rest - away_rest\n}\nsort games.game_id\ntake 5\n'})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_rest"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_rest"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_win"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"rest_spread"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"6"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"6"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"115"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Brooklyn Nets"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"100"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Utah Jazz"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"87"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"92"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TRUE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"12"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"12"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"106"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"76"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"15"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"15"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"94"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Portland Trail Blazers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TRUE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"18"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-29"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"18"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-29"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Indiana Pacers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"103"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"SQL DuckDB",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"CREATE TABLE by_game AS (\n  WITH _tab1 AS (\n    PIVOT_WIDER tidy ON variable USING FIRST(rest) GROUP BY (game_id, date)\n  )\n\n  SELECT\n    * EXCLUDE(away_team, home_team),\n    away_team AS away_rest,\n    home_team AS home_rest\n  FROM _tab1\n)\n"})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"CREATE TABLE joined AS (\n  SELECT\n    *,\n    home_points > away_points AS home_win,\n    home_rest - away_rest AS rest_spread\n  FROM by_game\n  LEFT JOIN games USING (game_id, date)\n  ORDER BY game_id\n)\n"})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:"showLineNumbers",children:"FROM joined\nLIMIT 5\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_rest"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_rest"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_win"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"rest_spread"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"6"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"115"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Brooklyn Nets"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"100"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Utah Jazz"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"87"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"92"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TRUE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"12"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"106"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"76"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"15"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"94"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Portland Trail Blazers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TRUE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"NA"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"18"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-29"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Indiana Pacers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"103"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"dplyr R",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:'by_game <- tidy |>\n  tidyr::pivot_wider(\n    id_cols = c("game_id", "date"),\n    values_from = "rest",\n    names_from = "variable"\n  ) |>\n  rename(\n    away_rest = away_team,\n    home_rest = home_team\n  )\n\njoined <- by_game |>\n  left_join(games, by = c("game_id", "date")) |>\n  mutate(\n    home_win = home_points > away_points,\n    rest_spread = home_rest - away_rest\n  )\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-r",metastring:"showLineNumbers",children:"joined |>\n  head(5)\n"})}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"game_id"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"date"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_rest"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_rest"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"away_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"away_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_team"}),(0,n.jsx)(t.th,{style:{textAlign:"right"},children:"home_points"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"home_win"}),(0,n.jsx)(t.th,{style:{textAlign:"left"},children:"rest_spread"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"6"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Chicago Bulls"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"115"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Brooklyn Nets"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"100"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"7"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Utah Jazz"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"87"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Detroit Pistons"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"92"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TRUE"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"12"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Cleveland Cavaliers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"106"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"76"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"15"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-28"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"New Orleans Pelicans"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"94"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Portland Trail Blazers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"TRUE"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"NA days"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"18"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"2015-10-29"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Memphis Grizzlies"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"112"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"Indiana Pacers"}),(0,n.jsx)(t.td,{style:{textAlign:"right"},children:"103"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"FALSE"}),(0,n.jsx)(t.td,{style:{textAlign:"left"},children:"0 days"})]})]})]})]}),(0,n.jsxs)(r.Z,{value:"Python Polars",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:'by_game = tidy.pivot(\n    values="rest", index=["game_id", "date"], columns="variable"\n).rename({"away_team": "away_rest", "home_team": "home_rest"})\n\njoined = by_game.join(games, on=["game_id", "date"]).with_columns(\n    home_win=pl.col("home_points") > pl.col("away_points"),\n    rest_spread=pl.col("home_rest") - pl.col("away_rest"),\n)\n'})}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:"joined.head(5)\n"})}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[6]}}),(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"game_id"}),(0,n.jsx)(t.th,{children:"date"}),(0,n.jsx)(t.th,{children:"away_rest"}),(0,n.jsx)(t.th,{children:"home_rest"}),(0,n.jsx)(t.th,{children:"away_team"}),(0,n.jsx)(t.th,{children:"away_points"}),(0,n.jsx)(t.th,{children:"home_team"}),(0,n.jsx)(t.th,{children:"home_points"}),(0,n.jsx)(t.th,{children:"home_win"}),(0,n.jsx)(t.th,{children:"rest_spread"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"u32"}),(0,n.jsx)(t.td,{children:"date"}),(0,n.jsx)(t.td,{children:"i8"}),(0,n.jsx)(t.td,{children:"i8"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"i64"}),(0,n.jsx)(t.td,{children:"str"}),(0,n.jsx)(t.td,{children:"i64"}),(0,n.jsx)(t.td,{children:"bool"}),(0,n.jsx)(t.td,{children:"i8"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"5"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"null"}),(0,n.jsx)(t.td,{children:'"Chicago Bulls"'}),(0,n.jsx)(t.td,{children:"115"}),(0,n.jsx)(t.td,{children:'"Brooklyn Nets"'}),(0,n.jsx)(t.td,{children:"100"}),(0,n.jsx)(t.td,{children:"false"}),(0,n.jsx)(t.td,{children:"null"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"6"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:"null"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:'"Utah Jazz"'}),(0,n.jsx)(t.td,{children:"87"}),(0,n.jsx)(t.td,{children:'"Detroit Piston\u2026'}),(0,n.jsx)(t.td,{children:"92"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"null"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"11"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"null"}),(0,n.jsx)(t.td,{children:'"Cleveland Cava\u2026'}),(0,n.jsx)(t.td,{children:"106"}),(0,n.jsx)(t.td,{children:'"Memphis Grizzl\u2026'}),(0,n.jsx)(t.td,{children:"76"}),(0,n.jsx)(t.td,{children:"false"}),(0,n.jsx)(t.td,{children:"null"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"14"}),(0,n.jsx)(t.td,{children:"2015-10-28"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"null"}),(0,n.jsx)(t.td,{children:'"New Orleans Pe\u2026'}),(0,n.jsx)(t.td,{children:"94"}),(0,n.jsx)(t.td,{children:'"Portland Trail\u2026'}),(0,n.jsx)(t.td,{children:"112"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"null"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"17"}),(0,n.jsx)(t.td,{children:"2015-10-29"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:"0"}),(0,n.jsx)(t.td,{children:'"Memphis Grizzl\u2026'}),(0,n.jsx)(t.td,{children:"112"}),(0,n.jsx)(t.td,{children:'"Indiana Pacers\u2026'}),(0,n.jsx)(t.td,{children:"103"}),(0,n.jsx)(t.td,{children:"false"}),(0,n.jsx)(t.td,{children:"0"})]})]})]}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:g[7]}})]})]}),"\n",(0,n.jsxs)(t.p,{children:["There are more columns in the PRQL result than in the other results. Because the output SQL is not using ",(0,n.jsx)(t.code,{children:"USING"})," for joins (",(0,n.jsx)(t.a,{href:"https://github.com/PRQL/prql/issues/1335",children:"PRQL/prql#1335"}),")."]}),"\n",(0,n.jsx)(t.p,{children:"The SQL generated by the PRQL compiler looks like this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",metastring:'showLineNumbers title="SQL"',children:"WITH table_0 AS (\n  SELECT\n    *\n  FROM\n    (\n      PIVOT_WIDER tidy ON variable USING FIRST(rest)\n      GROUP BY\n        (game_id, date)\n    )\n),\ntable_1 AS (\n  SELECT\n    * EXCLUDE (away_team, home_team),\n    away_team AS away_rest,\n    home_team AS home_rest\n  FROM\n    table_0\n)\nSELECT\n  table_1.*,\n  games.*,\n  games.home_points > games.away_points AS home_win,\n  table_1.home_rest - table_1.away_rest AS rest_spread\nFROM\n  table_1\n  LEFT JOIN games ON table_1.game_id = games.game_id\n  AND table_1.date = games.date\nORDER BY\n  games.game_id\nLIMIT\n  5\n\n-- Generated by PRQL compiler version:0.11.1 target:sql.duckdb (https://prql-lang.org)\n"})})]})}function o(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(j,{...e})}):j(e)}},5162:(e,t,l)=>{l.d(t,{Z:()=>r});l(7294);var n=l(6905);const s={tabItem:"tabItem_Ymn6"};var i=l(5893);function r(e){let{children:t,hidden:l,className:r}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,n.Z)(s.tabItem,r),hidden:l,children:t})}},4866:(e,t,l)=>{l.d(t,{Z:()=>b});var n=l(7294),s=l(6905),i=l(2466),r=l(6550),d=l(469),h=l(1980),a=l(7392),x=l(12);function c(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function g(e){const{values:t,children:l}=e;return(0,n.useMemo)((()=>{const e=t??function(e){return c(e).map((e=>{let{props:{value:t,label:l,attributes:n,default:s}}=e;return{value:t,label:l,attributes:n,default:s}}))}(l);return function(e){const t=(0,a.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,l])}function j(e){let{value:t,tabValues:l}=e;return l.some((e=>e.value===t))}function o(e){let{queryString:t=!1,groupId:l}=e;const s=(0,r.k6)(),i=function(e){let{queryString:t=!1,groupId:l}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!l)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return l??null}({queryString:t,groupId:l});return[(0,h._X)(i),(0,n.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(s.location.search);t.set(i,e),s.replace({...s.location,search:t.toString()})}),[i,s])]}function y(e){const{defaultValue:t,queryString:l=!1,groupId:s}=e,i=g(e),[r,h]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:l}=e;if(0===l.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!j({value:t,tabValues:l}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${l.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=l.find((e=>e.default))??l[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i}))),[a,c]=o({queryString:l,groupId:s}),[y,m]=function(e){let{groupId:t}=e;const l=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,i]=(0,x.Nk)(l);return[s,(0,n.useCallback)((e=>{l&&i.set(e)}),[l,i])]}({groupId:s}),A=(()=>{const e=a??y;return j({value:e,tabValues:i})?e:null})();(0,d.Z)((()=>{A&&h(A)}),[A]);return{selectedValue:r,selectValue:(0,n.useCallback)((e=>{if(!j({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);h(e),c(e),m(e)}),[c,m,i]),tabValues:i}}var m=l(2389);const A={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var u=l(5893);function f(e){let{className:t,block:l,selectedValue:n,selectValue:r,tabValues:d}=e;const h=[],{blockElementScrollPositionUntilNextRender:a}=(0,i.o5)(),x=e=>{const t=e.currentTarget,l=h.indexOf(t),s=d[l].value;s!==n&&(a(t),r(s))},c=e=>{let t=null;switch(e.key){case"Enter":x(e);break;case"ArrowRight":{const l=h.indexOf(e.currentTarget)+1;t=h[l]??h[0];break}case"ArrowLeft":{const l=h.indexOf(e.currentTarget)-1;t=h[l]??h[h.length-1];break}}t?.focus()};return(0,u.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":l},t),children:d.map((e=>{let{value:t,label:l,attributes:i}=e;return(0,u.jsx)("li",{role:"tab",tabIndex:n===t?0:-1,"aria-selected":n===t,ref:e=>h.push(e),onKeyDown:c,onClick:x,...i,className:(0,s.Z)("tabs__item",A.tabItem,i?.className,{"tabs__item--active":n===t}),children:l??t},t)}))})}function p(e){let{lazy:t,children:l,selectedValue:s}=e;const i=(Array.isArray(l)?l:[l]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===s));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return(0,u.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function _(e){const t=y(e);return(0,u.jsxs)("div",{className:(0,s.Z)("tabs-container",A.tabList),children:[(0,u.jsx)(f,{...e,...t}),(0,u.jsx)(p,{...e,...t})]})}function b(e){const t=(0,m.Z)();return(0,u.jsx)(_,{...e,children:c(e.children)},String(t))}},1151:(e,t,l)=>{l.d(t,{Z:()=>d,a:()=>r});var n=l(7294);const s={},i=n.createContext(s);function r(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);